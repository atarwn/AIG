# AIG
Arch Installation Guide + Nvidia drivers on hybrid muxless systems

[English Version (not even started)](README_en.md)

# Приветсвую

Вы попали на очередной гайд по установке Arch линукс. Чем мой лучше других?

- Поясню за моменты, неочевидные новичкам

Но всё равно это n+1 в бесконечное море информации.

Вы можете применить этот гайд и к Arch-подобным, как Artix. 
Но всё же, это не 100% решение, оно может дополнить, но не заменит официальные гайды.

# Установка Arch Linux

# Глава 1

Установка начинается с archiso, или понятнее, загрузочного образа Arch Linux который вы можете скачать на [их сайте](https://archlinux.org/download/). 
Я рекомендую скачивать именно Torrent так как он быстрее и надежнее.

И ещё один момент: Вполне может возникнуть момент, понятный мне, но по каким то причинам не понятный тебе. Поэтому, вот три шага к нахождению ответов:
1. [Прочитайте "Как правильно задавать вопросы"](https://sitengine.ru/smart-question-ru.html), этот документ поможет не только правильно гуглить, но и улучшить взаимодействие с другими человеками
2. Воспользуйтесь ИИ поисковиками, типа [Perplexity](https://perplexity.ai)
3. Но всё же, [**RTFM**: ЧИТАЙ ГРЕбАНЫЙ МАНУАЛ!!1!](https://wiki.archlinux.org)

## Проверка связи

Самый простой: Написать команду `ping 1.1.1.1`, она отправит по сети пакеты. Их можно сравнить с эхом от гор, вы кричите, и ждёте пока ваше эхо вернётся. Если в ответ тишина или ошибка, подключитесь к интернету по кабелю или...

### iwctl

Это утилита для подключения к WiFi сетям, отличное решение для минимальных сборок и лучшего терминального опыта. Вам понадобятся всего 4 команды:
- `station wlan0 scan`
- `station wlan0 get-networks`
- `station wlan0 connect <SSID вашей сети>`

Если что-то не так, посмотрите какое устройство у вас отвечает за WiFi через команду `device list`.

[RTFM](https://wiki.archlinux.org/title/Iwd#iwctl)

### Мобильное подключение

[RTFM](https://wiki.archlinux.org/title/Mobile_broadband_modem#ModemManager)

## Разметка диска

Отлично, интернет есть. Теперь надо разметить диск. Напишите команду lsblk - она выведет список дисков и разделов.

> Pro tip: Запоминайте размеры разделов, если ставите рядом с другой ОС. По размеру можно будет понять какой раздел можно трогать а какой нет.

Если диск пустой/новый, можно сразу перейти к разметке.

Если нет, рекомендую снести все разделы и диск командой `wipefs`.

**Пример**
```bash
# lsblk
NAME        MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS
nvme0n1     259:0    0 476.9G  0 disk 
└─nvme0n1p1 259:1    0 476.9G  0 part
nvme1n1     259:2    0 476.9G  0 disk 
├─nvme1n1p1 259:3    0   512M  0 part 
├─nvme1n1p2 259:4    0 238.2G  0 part
├─nvme1n1p3 259:5    0    16M  0 part 
└─nvme1n1p4 259:6    0 238.2G  0 part
# wipefs -a /dev/nvme1n1p2
....
```

### Разметка и создание разделов

[RTFM: Утилита cfdisk]([https://www.redhat.com/en/blog/partitions-fdisk](https://www.siberoloji.com/understanding-the-cfdisk-command-in-linux-a-guide-for-advanced-users/))
[STFW: Как пользоватся cfisk (rus)](https://www.google.com/search?q=Как+пользоватся+cfdisk)
[**RTFM: Разметка диска**](https://wiki.archlinux.org/title/Installation_guide#Partition_the_disks)

Поясняю за UEFI, BIOS, GPT, MBR.

UEFI+GPT - Лучшее сочетание, современная быстрая таблица разделов с современным подходом к загрузке через EFI, но требует специального EFI раздела (в /boot или /boot/efi - второй лучше если у вас будет много Linux-ов на одном диске).

BIOS+MBR - В отличае от UEFI+GPT, более прямолинейный. MBR заранее имеет загрузочную область для BIOS, поэтому при разметке можно не создавать дополнительный раздел для /boot.

Гайд по установке также рекомендукт SWAP раздел, но **я против**. Создание отдельного раздела для SWAP в современном мире не имеет смысла, ведь можно создать SWAP файл, он будет гибче и проще в использовании.


## Pacstrap

Оч много всяких гайдеров пишут всякие опции но вам (новичкам) они не нужны, и иногда могут принести больше головной боли, поэтому просто пишем:

`pacstrap /mnt (список пакетов)`

А вот и пакеты:
- `base`: Базовая работоспособная система
- `linux`: Ядро linux
- `linux-firmware`: Очень важный пакет с драйверами для устройст в вашем пк/ноуте включая видеокарту, WiFi, интернет и прочее
- `grub`: Классический загрузчик для Linux, удобен на BIOS системах
- `refind`: Более удобный загрузчик для Linux на UEFI системах
- `intel-ucode`/`amd-ucode`: Микрокод для процессора, рекомендуется (если у вас intel то intel-ucode, если amd то не поверите amd-ucode)
- `networkmanager`: Менеджер сетей который используют 90% окружений рабочего стола, включая GNOME, Plasma, Mate, pantheon, XFCE4, итд
- `bluez`: Блютуз, если нет то не ставь
- `neovim`: Современный редактор текста в консоли, очень удобен если научится
- `nano`: Простой редактор текста в консоли, подойдет для новичков, но у меня вопрос если вы vim-ом не умеете пользоватся зачем в Arch лезете
### GNOME (минимальный)
- `gnome-desktop gnome-console gnome-control-center gdm`: Базовое окружение GNOME с терминалом и настройками
- `gnome-backgrounds`: Фоны для GNOME
- `gnome-text-editor`: Редактор текста
- `nautilus`: Файловый менеджер
- `loupe`: Просмоторщик изображений
- `showtime`: Просмоторщик видео
- `decibels`: Аудиопроигрыватель

Больше вы найдете на [apps.gnome.org](https://apps.gnome.org/). Зачастую названия программ и их названия пакетов совпадают, но вы всегда можете поискать в гребаном интернете (STFW).

## Настройка системы

Сделав `arch-chroot` в свежеустановленную систему, не забудье:
1. Включить сервисы
  - `systemctl enable NetworkManager`
  - `systemctl enable bluetooth` # Если поставили bluez
  - `systemctl enable gdm` # Если поставили GNOME
2. Сгенерировать локали, связать верменную зону, задать таблицу разделов и имя хоста, поставить пароль рута
  [RTFM](https://wiki.archlinux.org/title/Installation_guide#Configure_the_system)
3. Пользователя не забудьте создать:
  - `useradd -mG wheel,audio,video,storage,input <username>`
  - `passwd <username>`

## Установка загрузчика

Вы должны быть в arch-chroot.

Для BIOS:
  1. Поставьте пакет `grub`
  2. `grub-install --recheck`
  3. `grub-mkconfig -o /boot/grub/grub.cfg`

Для UEFI:
  1. Поставьте пакет `refind`
  2. `refind-install`

# Nvidia на muxless hybrid системах (iGPU приварен к экрану, понять это без ошибки невозможно)

> Далее речь будет идти о системе Intel+NVIDIA - iGPU+dGPU соответсвенно

Итак, самый простой способ выяснить находитесь ли вы на muxless системе - поставить пакет nvidia.

Сделать `su -c 'echo "blacklist nouveau" > /etc/modprobe.d/nouveau.conf'`  
И `mkinitcpio -P`

Перезагрузитесь. Черный экран? Круто, читайте дальше.

Загрузившись с archiso и зайдя в вашу систему через arch-chroot напишите эти команды:  
1. `echo "options nvidia-drm modeset=0" > /etc/modprobe.d/nvidia.conf`
2. `mkinitcpio -P`

Обычно помогает
